Ссылка на официальную документацию
https://kb.infowatch.com/pages/viewpage.action?pageId=125508152


#ПЕРЕНОС БД

Чтобы пересоздать схему БД на новом сервере, выполните следующие действия:

На сервере Traffic Monitor выполните запрос от имени пользователя iwtm:

psql -U postgres -d iwtm

select to_char(min(part_date), 'yyyy-mm-dd')
from tbs_list
where status in (1,4)

exit

Запомните результат. Например: 2015-01-20
Остановите следующие сервисы (а также другие сервисы подключения к БД):

service iwtm stop
service php-fpm stop
service nginx stop

Перейдите в директорию, в которой хранятся схемы базы данных и скрипты их развертывания:

Для PostgreSQL: /opt/iw/tm5/csw/postgres

Удалите схему:

./uninstall.sh

В файле database.conf добавьте параметр tbs_start_date. В качестве значения параметра укажите дату, полученную в п. 1. Например:
Для PostgreSQL: \set tbs_start_date '2015-01-20'
Установите схему с новым параметром: ./install.sh
Запустите сервисы iwtm: service iwtm start


#УСТАНОВКА МИГРАТОРА
Утилита для переноса данных входит в поставку Системы.
Чтобы установить мигратор, выполните следующие действия:

Перейдите в директорию /opt/distr/infowatch/traffic-monitor/Linux/:

cd /opt/distr/infowatch/traffic-monitor/Linux/
Установите пакет с мигратором:

rpm -i install iwtm-migrator-6.x.x-release.x86_64.rpm
где 6.x.x – номер версии.


# МИГРАЦИЯ КОНФИГУРАЦИИ

service iwtm start

Чтобы произвести миграцию конфигурации на сервере с ТМ 6.1, выполните следующие действия:

Перейдите в директорию /opt/iw/tm5/bin/migrator:

cd /opt/iw/tm5/bin/migrator
Задайте переменную окружения: export src_constr="имя/пароль@хост/iwtm"
 Параметры подключения к БД: iwtm/xxXX1234@192.168.99.3/iwtm.
Дополнительно могут быть запрошены значения параметров. Убедитесь, что значения параметров по умолчанию (для создания LDAP-сервера ТМ 6.1):

--serman_host = 127.0.0.1
--serman_username = serman_client
--serman_password = xx1234
--serman_port = 9998
--adlibitum_tool  = /opt/iw/tm5/bin/adlibitum-tool

Запустите миграцию, используя скрипт:
dst_constr="postgresql://имя:пароль@хост:5433/postgres"
./iw_migrator_config --dest_backend postgresql --source_db "$src_constr" --dest_db "$dst_constr" --json "/opt/iw/tm5/migration.json" 2>&1 | tee "/var/log/infowatch/migration.log"

*Примечание:*
Чтобы получить справку по утилите, выполните команду: 
./iw_migrator_config --help 
или: 
./iw_migrator_config –h 
при выполнении без параметров для получения краткой информации.

*Внимание!*
Если миграция событий будет запускаться на другой машине, то этот файл необходимо перенести на неё по тому же пути.


#МИГРАЦИЯ СОБЫТИЙ
Для миграции событий используется файл /opt/iw/tm5/migration.json, созданный мигратором конфигурации.
Чтобы произвести миграцию событий, выполните следующие действия:

1) В файле /opt/iw/tm5/migration.json проставьте уровень нарушения для цветов (low, medium, high) в таблице color_to_violation_level. Например: "ORANGE":"Medium".
2) Отредактируйте файл /opt/iw/tm5/etc/migrator_object.conf;
3) Укажите путь к migration.json в качестве значения параметра ConfigJson;
4) Укажите путь к БД TM 4.x в качестве значения параметра SrcConnString ("ip:port/service name");
5) Укажите актуальные логин и пароль пользователя БД TM 4.x в параметрах SrcDbUser и SrcDbPassword.
6) Добавьте запись о Migrator2Loader-TCP в конфигурационный файл /opt/iw/tm5/etc/loader.conf :

"Pipes": {
    "Backward": [
        "XML2Liro2Loader-TCP", "Migrator2Loader-TCP"
   ],
    "Forward": []
}

7) Перезапустите процесс iw_loader:

service iwtm restart loader

8) Запустите процесс миграции событий:

service iwtm start migrator_object

9) После завершения миграции удалите запись о Migrator2Loader-TCP в конфигурационном файле /opt/iw/tm5/etc/loader.conf.
10) Перезапустите процесс iw_loader:

service iwtm restart loader


